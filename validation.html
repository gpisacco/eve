
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Data Validation &mdash; Eve 0.3-dev documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Eve 0.3-dev documentation" href="index.html" />
    <link rel="next" title="Authentication and Authorization" href="authentication.html" />
    <link rel="prev" title="Configuration Handling" href="config.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
  
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="authentication.html" title="Authentication and Authorization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="config.html" title="Configuration Handling"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Eve 0.3-dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="data-validation">
<span id="validation"></span><h1>Data Validation<a class="headerlink" href="#data-validation" title="Permalink to this headline">¶</a></h1>
<p>Data validation is provided out-of-the-box. Your configuration includes
a <a class="reference internal" href="config.html#schema"><em>Schema Definition</em></a> for every resource managed by the API. Data sent to the API
to be inserted or updated will be validated against the schema, and a resource
will be updated only if validation passes.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> curl -d <span class="s1">&#39;{&quot;firstname&quot;: &quot;bill&quot;, &quot;lastname&quot;: &quot;clinton&quot;}, {&quot;firstname&quot;: &quot;mitt&quot;, &quot;lastname&quot;: &quot;romney&quot;}]&#39;</span> -H <span class="s1">&#39;Content-Type: application/json&#39;</span> http://eve-demo.herokuapp.com/people
<span class="go">HTTP/1.1 200 OK</span>
</pre></div>
</div>
<p>The response will contain a success/error state for each item provided in the
request:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;_status&quot;</span><span class="o">:</span> <span class="s2">&quot;ERR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_issues&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;lastname&quot;</span><span class="o">:</span> <span class="s2">&quot;value &#39;clinton&#39; not unique&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;_status&quot;</span><span class="o">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_updated&quot;</span><span class="o">:</span> <span class="s2">&quot;Thu, 22 Nov 2012 15:29:08 GMT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;50ae44c49fa12500024def5d&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_links&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;self&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;href&quot;</span><span class="o">:</span> <span class="s2">&quot;eve-demo.herokuapp.com/people/50ae44c49fa12500024def5d&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;person&quot;</span><span class="p">}}</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In the example above, the first document did not validate and was rejected,
while the second was successfully created. The API maintainer has complete
control of data validation.</p>
<div class="section" id="extending-data-validation">
<h2>Extending Data Validation<a class="headerlink" href="#extending-data-validation" title="Permalink to this headline">¶</a></h2>
<p>Data validation is based on the <a class="reference external" href="http://cerberus.readthedocs.org">Cerberus</a> validation system and it is therefore
extensible. As a matter of fact, Eve&#8217;s MongoDB data-layer itself extends
Cerberus validation, implementing the <tt class="docutils literal"><span class="pre">unique</span></tt> and <tt class="docutils literal"><span class="pre">data_relation</span></tt>
constraints and the <tt class="docutils literal"><span class="pre">ObjectId</span></tt> data type on top of the standard rules.</p>
</div>
<div class="section" id="custom-validation-rules">
<h2>Custom Validation Rules<a class="headerlink" href="#custom-validation-rules" title="Permalink to this headline">¶</a></h2>
<p>Suppose that in your specific and very peculiar use case, a certain value can
only be expressed as an odd integer. You decide to add support for a new
<tt class="docutils literal"><span class="pre">isodd</span></tt> rule to our validation schema. This is how you would implement
that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">eve.io.mongo</span> <span class="kn">import</span> <span class="n">Validator</span>

<span class="k">class</span> <span class="nc">MyValidator</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_validate_isodd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isodd</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">isodd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">&quot;Value must be an odd number&quot;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Eve</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">MyValidator</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>By subclassing the base Mongo validator class and then adding a custom
<tt class="docutils literal"><span class="pre">_validate_&lt;rulename&gt;</span></tt> method, you extended the available <a class="reference internal" href="config.html#schema"><em>Schema Definition</em></a>
grammar and now the new custom rule <tt class="docutils literal"><span class="pre">isodd</span></tt> is available in your schema. You
can now do something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;schema&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;oddity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;isodd&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;integer&#39;</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-data-types">
<h2>Custom Data Types<a class="headerlink" href="#custom-data-types" title="Permalink to this headline">¶</a></h2>
<p>You can also add new data types by simply adding <tt class="docutils literal"><span class="pre">_validate_type_&lt;typename&gt;</span></tt>
methods to your subclass. Consider the following snippet from the Eve source
code.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">_validate_type_objectid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Enables validation for `objectid` schema attribute.</span>

<span class="sd">    :param unique: Boolean, whether the field value should be</span>
<span class="sd">                   unique or not.</span>
<span class="sd">    :param field: field name.</span>
<span class="sd">    :param value: field value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;[a-f0-9]{24}&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">ERROR_BAD_TYPE</span> <span class="o">%</span> <span class="s">&#39;ObjectId&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This method enables support for MongoDB <tt class="docutils literal"><span class="pre">ObjectId</span></tt> type in your schema,
allowing something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;schema&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;owner&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;objectid&#39;</span><span class="p">,</span>
        <span class="s">&#39;required&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also check the <a class="reference external" href="https://github.com/nicolaiarocci/eve/blob/develop/eve/io/mongo/validation.py">source code</a> for Eve custom validation, where you will
find more advanced use cases, such as the implementation of the <tt class="docutils literal"><span class="pre">unique</span></tt> and
<tt class="docutils literal"><span class="pre">data_relation</span></tt> constraints. Please see the <a class="reference external" href="http://cerberus.readthedocs.org">Cerberus</a> documentation for
a complete list rules and data types available.</p>
</div>
<div class="section" id="allowing-the-unknown">
<span id="unknown"></span><h2>Allowing the Unknown<a class="headerlink" href="#allowing-the-unknown" title="Permalink to this headline">¶</a></h2>
<p>Normally you don&#8217;t want clients to inject unknown fields in your documents.
However, there might be circumstances where this is desirable. During the
development cycle, for example, or when you are dealing with very heterogeneous
data. After all, not forcing normalized information is one of the selling
points of MongoDB and many other NoSQL data stores.</p>
<p>In Eve, you achieve this by setting the <tt class="docutils literal"><span class="pre">ALLOW_UNKNOWN</span></tt> option to <tt class="docutils literal"><span class="pre">True</span></tt>.
Once this option is enabled, fields matching the schema will be validated
normally, while unknown fields will be quietly stored without a glitch. You
can also enable this feature only for certain endpoints by setting the
<tt class="docutils literal"><span class="pre">allow_unknown</span></tt> local option.</p>
<p>Consider the following domain:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DOMAIN</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;people&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;allow_unknown&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">&#39;schema&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;firstname&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;string&#39;</span><span class="p">},</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>You normally could only add (POST) or edit (PATCH) <cite>firstnames</cite> to the
<tt class="docutils literal"><span class="pre">/people</span></tt> endpoint. However, since <tt class="docutils literal"><span class="pre">allow_unknown</span></tt> has been enabled, even
a payload like this will be accepted:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> curl -d <span class="s1">&#39;[{&quot;firstname&quot;: &quot;bill&quot;, &quot;lastname&quot;: &quot;clinton&quot;}, {&quot;firstname&quot;: &quot;bill&quot;, &quot;age&quot;:70}]&#39;</span> -H <span class="s1">&#39;Content-Type: application/json&#39;</span> http://eve-demo.herokuapp.com/people
<span class="go">HTTP/1.1 200 OK</span>
</pre></div>
</div>
<div class="admonition-please-note admonition">
<p class="first admonition-title">Please note</p>
<p class="last">Use this feature with extreme caution. Also be aware that, when this
option is enabled, clients will be capable of actually <cite>adding</cite> fields via
PATCH (edit).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="index.html">
      <img class="logo" src="_static/eve-sidebar.png" alt="Logo"/>
  </a>
</p>
<p>
  <iframe src="http://ghbtns.com/github-btn.html?user=nicolaiarocci&repo=eve&type=watch&count=true&size=large"
    allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p> 
<!--<h3>About Eve</h3>-->
<p>
  You are looking at the documentation of the development version.
</p>
<h3>Support Eve</h3>
<p>If your organization uses Eve, consider financial support:</p>
<p>
<a href="https://gum.co/EhzI" class="gumroad-button">Eve Pro</a> <script type="text/javascript" src="https://gumroad.com/js/gumroad.js"></script>
</p>
<h3>Get Updates</h3>
<p>Receive updates on new releases and upcoming projects.</p>
<p>
<a href="http://tinyletter.com/nicolaiarocci">Subscribe to Newsletter</a>
</p>
<h3>Useful Links</h3>
<ul>
  <li><a href="http://stackoverflow.com/questions/tagged/eve">Stack Overflow</a></li>
  <li><a href="https://groups.google.com/forum/#!forum/python-eve">Mailing List</a></li>
  <li><a href="http://github.com/nicolaiarocci/eve/issues">Issue Tracker</a></li>
  <li><a href="http://github.com/nicolaiarocci/eve">GitHub</a></li>
  <li><a href="http://blog.python-eve.org/">Blog</a></li>
  <li><a href="http://github.com/nicolaiarocci/eve-demo">Demo</a></li>
  <li><a href="irc://irc.freenode.net/python-eve">IRC</a>
</ul>
<h3>Feedback</h3>
<p>
  Feedback is greatly appreciated. If you have any questions, comments,
  random praise, or anonymous threats, get on the <a href="https://groups.google.com/forum/#!forum/python-eve">mailing list</a> or <a href="mailto:eve@nicolaiarocci.com">
  shoot an email</a>.
</p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Data Validation</a><ul>
<li><a class="reference internal" href="#extending-data-validation">Extending Data Validation</a></li>
<li><a class="reference internal" href="#custom-validation-rules">Custom Validation Rules</a></li>
<li><a class="reference internal" href="#custom-data-types">Custom Data Types</a></li>
<li><a class="reference internal" href="#allowing-the-unknown">Allowing the Unknown</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="config.html" title="previous chapter">Configuration Handling</a></li>
      <li>Next: <a href="authentication.html" title="next chapter">Authentication and Authorization</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2014. A <a href="http://nicolaiarocci.com">Nicola Iarocci</a> Project.
  </div>
  <a href="https://github.com/nicolaiarocci/eve" class="github">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="_static/forkme_right_green_007200.png" alt="Fork me on GitHub"  class="github"/>
  </a>
  
  </body>
</html>